
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/502_dag.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_502_dag.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_502_dag.py:


DAG to Define and Simulate
==========================

Splitting and partitioning will preserve the relationships between streams enabling network creation for simple cases.
In more complex cases the DAG (Directed Acyclic Graph) construct can be useful to define the relationships between
streams resulting from transformations (operations) on the streams.

The DAG can be used to define the network and, with the run method, simulate the network to produce the final results.

.. GENERATED FROM PYTHON SOURCE LINES 12-25

.. code-block:: default

    import logging
    from copy import deepcopy

    import plotly

    from elphick.mass_composition import MassComposition, Stream
    from elphick.mass_composition.dag import DAG
    from elphick.mass_composition.datasets.sample_data import sample_data
    from elphick.mass_composition.flowsheet import Flowsheet

    logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    logger = logging.getLogger(__name__)








.. GENERATED FROM PYTHON SOURCE LINES 26-31

Define the DAG
--------------

The DAG is defined by adding nodes to the graph.  Each node is an input, output or Stream operation
(e.g. add, split, etc.).  The nodes are connected by the streams they operate on.

.. GENERATED FROM PYTHON SOURCE LINES 31-52

.. code-block:: default


    mc_sample: MassComposition = MassComposition(sample_data(), name='sample')

    dag = DAG(n_jobs=1)
    dag.add_input(name='feed_1')
    dag.add_input(name='feed_2')
    dag.add_step(name='joiner', operation=MassComposition.add, streams=['feed_1', 'feed_2'], kwargs={'name': 'feed'})
    dag.add_step(name='split', operation=MassComposition.split, streams=['feed'],
                 kwargs={'fraction': 0.3, 'name_1': 'lump', 'name_2': 'fines'})
    dag.add_step(name='split_2', operation=MassComposition.split, streams=['lump'],
                 kwargs={'fraction': 0.3, 'name_1': 'lumpier', 'name_2': 'less_lumpy'})
    dag.add_step(name='split_3', operation=MassComposition.split, streams=['fines'],
                 kwargs={'fraction': 0.3, 'name_1': 'finer', 'name_2': 'less_fine'})
    dag.add_step(name='joiner_1', operation=MassComposition.add, streams=['less_lumpy', 'less_fine'],
                 kwargs={'name': 'mix_1'})
    dag.add_step(name='joiner_2', operation=MassComposition.add, streams=['lumpier', 'finer'],
                 kwargs={'name': 'mix_2'})
    dag.add_output(name='product_1', stream='mix_1')
    dag.add_output(name='product_2', stream='mix_2')






.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <elphick.mass_composition.dag.DAG object at 0x7f39501ba2f0>



.. GENERATED FROM PYTHON SOURCE LINES 53-58

Run the DAG
-----------

The dag is run by providing MassComposition (or Stream) objects for all inputs.  They must be compatible i.e. have the
same indexes.

.. GENERATED FROM PYTHON SOURCE LINES 58-63

.. code-block:: default


    dag.run({'feed_1': mc_sample,
             'feed_2': deepcopy(mc_sample).rename('sample_2')  # names must be unique
             }, progress_bar=False)








.. GENERATED FROM PYTHON SOURCE LINES 64-65

Create a Flowsheet object from the dag, enabling all the usual network plotting and analysis methods.

.. GENERATED FROM PYTHON SOURCE LINES 65-71

.. code-block:: default


    fs: Flowsheet = Flowsheet.from_dag(dag)

    fig = fs.plot_network()
    plotly.io.show(fig)




.. raw:: html
    :file: images/sphx_glr_502_dag_001.html





.. GENERATED FROM PYTHON SOURCE LINES 72-75

.. code-block:: default


    fig = fs.table_plot(plot_type='sankey')
    fig





.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
            <script charset="utf-8" src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>                <div id="1597de78-701b-4b4b-a0dd-0b27c68563e7" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("1597de78-701b-4b4b-a0dd-0b27c68563e7")) {                    Plotly.newPlot(                        "1597de78-701b-4b4b-a0dd-0b27c68563e7",                        [{"cells":{"align":"left","fill":{"color":[["whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke","lightgray","whitesmoke"]]},"format":["%s",".0f",".0f",".1f",".2f",".2f",".2f",".2f"],"values":[["sample","sample_2","feed","lump","fines","less_lumpy","lumpier","less_fine","finer","mix_1","mix_2"],[300.0,300.0,600.0,180.0,420.0,126.0,54.0,294.0,126.0,420.0,180.0],[260.0,260.0,520.0,156.0,364.0,109.19999999999999,46.8,254.79999999999995,109.2,363.99999999999994,156.0],[13.333333333333334,13.333333333333334,13.333333333333334,13.333333333333334,13.333333333333334,13.333333333333341,13.33333333333334,13.33333333333335,13.33333333333333,13.333333333333346,13.333333333333334],[59.0,59.0,59.0,59.0,58.99999999999999,59.0,59.0,59.00000000000001,59.00000000000001,59.0,59.0],[3.5153846153846153,3.5153846153846153,3.5153846153846153,3.5153846153846158,3.5153846153846153,3.5153846153846158,3.5153846153846153,3.5153846153846158,3.515384615384616,3.5153846153846158,3.5153846153846158],[1.873076923076923,1.873076923076923,1.8730769230769233,1.8730769230769233,1.8730769230769229,1.8730769230769235,1.8730769230769235,1.8730769230769233,1.8730769230769235,1.8730769230769233,1.8730769230769233],[4.0,4.0,4.0,4.0,4.0,4.0,4.000000000000001,4.0,4.0,4.0,4.0]]},"columnwidth":[2,1,1,1,1,1,1,1],"header":{"align":"center","fill":{"color":"cornflowerblue"},"font":{"color":"black","size":12},"values":["name","mass_wet","mass_dry","H2O","Fe","SiO2","Al2O3","LOI"]},"type":"table","domain":{"x":[0.0,0.36000000000000004],"y":[0.0,1.0]}},{"link":{"customdata":["\u003cbr \u002f\u003emass_wet: 300\u003cbr \u002f\u003emass_dry: 260\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e","\u003cbr \u002f\u003emass_wet: 300\u003cbr \u002f\u003emass_dry: 260\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e","\u003cbr \u002f\u003emass_wet: 600\u003cbr \u002f\u003emass_dry: 520\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e","\u003cbr \u002f\u003emass_wet: 180\u003cbr \u002f\u003emass_dry: 156\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e","\u003cbr \u002f\u003emass_wet: 420\u003cbr \u002f\u003emass_dry: 364\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e","\u003cbr \u002f\u003emass_wet: 126\u003cbr \u002f\u003emass_dry: 109\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e","\u003cbr \u002f\u003emass_wet: 54\u003cbr \u002f\u003emass_dry: 47\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e","\u003cbr \u002f\u003emass_wet: 294\u003cbr \u002f\u003emass_dry: 255\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e","\u003cbr \u002f\u003emass_wet: 126\u003cbr \u002f\u003emass_dry: 109\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e","\u003cbr \u002f\u003emass_wet: 420\u003cbr \u002f\u003emass_dry: 364\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e","\u003cbr \u002f\u003emass_wet: 180\u003cbr \u002f\u003emass_dry: 156\u003cbr \u002f\u003eH2O: 13.3\u003cbr \u002f\u003eFe: 59.00\u003cbr \u002f\u003eSiO2: 3.52\u003cbr \u002f\u003eAl2O3: 1.87\u003cbr \u002f\u003eLOI: 4.00\u003cbr \u002f\u003e"],"hovertemplate":"\u003cb\u003e\u003ci\u003e%{label}\u003c\u002fi\u003e\u003c\u002fb\u003e\u003cbr \u002f\u003eSource: %{source.customdata}\u003cbr \u002f\u003eTarget: %{target.customdata}\u003cbr \u002f\u003e%{customdata}","label":["sample","sample_2","feed","lump","fines","less_lumpy","lumpier","less_fine","finer","mix_1","mix_2"],"source":[0,1,2,3,3,4,4,5,5,6,7],"target":[2,2,3,4,5,6,7,6,7,8,9],"value":[300.0,300.0,600.0,180.0,420.0,126.0,54.0,294.0,126.0,420.0,180.0]},"node":{"color":["blue","blue","green","green","green","green","green","green","blue","blue"],"customdata":["feed_1","feed_2","joiner","split","split_2","split_3","joiner_1","joiner_2","product_1","product_2"],"label":["feed_1","feed_2","joiner","split","split_2","split_3","joiner_1","joiner_2","product_1","product_2"],"line":{"color":"black","width":0.5},"pad":15,"thickness":20},"type":"sankey","domain":{"x":[0.4600000000000001,1.0],"y":[0.0,1.0]}}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"title":{"text":"DAG\u003cbr\u003e\u003csup\u003eBalanced: True, Edge Status OK: True\u003c\u002fsup\u003e"},"font":{"size":12}},                        {"responsive": true}                    )                };                            </script>        </div>
    </div>
    <br />
    <br />


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  1.558 seconds)


.. _sphx_glr_download_auto_examples_502_dag.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 502_dag.py <502_dag.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 502_dag.ipynb <502_dag.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
